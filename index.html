<!DOCTYPE html>
<html lang="de">
<head>
  <style>
    .editable {
      width: 100%;
      min-height: 150px;
      border: 1px solid #ccc;
      padding: 10px;
    }
    .mark.rot { background-color: #f7c5c5; }
    .mark.gelb { background-color: #fff3b0; }
    .mark.gruen { background-color: #c8f7c5; }
  </style>
</head>
<meta charset="UTF-8" />
<title>DQE mit Dummytexts</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 16px; background: #f5f5f5; }
  h3 { margin: 0.5rem 0; }

  /* Top bar: badges + legend combined */
  .topbar {
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
    background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06); margin-bottom: 16px;
  }
  .ampel-badges { display: flex; gap: 8px; }
  .badge {
    border: none; color: #fff; padding: 0.5rem 0.9rem; border-radius: 6px; cursor: pointer; font-weight: 600;
  }
  .badge.gruen { background: #228b22; }
  .badge.gelb  { background: #ff8c00; }
  .badge.rot   { background: #c62828; }

  .legend { display: flex; align-items: center; gap: 14px; margin-left: auto; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 8px; color: #333; font-size: 0.95rem; }
  .dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
  .dot--green { background: #00cc66; }
  .dot--yellow { background: #ffcc00; }
  .dot--red { background: #ff3333; }

  /* Overlay boxes toggled by badges */
  .overlay-box {
    background: #fff; border-left: 6px solid; padding: 1rem; border-radius: 8px;
    margin-bottom: 20px; display: none; border: 1px solid #ddd;
  }
  #overlay-gruen { border-color: #228b22; }
  #overlay-gelb  { border-color: #ff8c00; }
  #overlay-rot   { border-color: #c62828; }

  /* Two windows side-by-side */
  .container { display: flex; gap: 24px; }
  .window {
    flex: 1; background: #fff; border: 1px solid #ddd; border-radius: 8px;
    padding: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  }
  .window h3 { margin-top: 0; }

  /* Segments */
  .mark { cursor: pointer; border-radius: 3px; padding: 0 2px; transition: box-shadow 120ms ease; }
  .mark:hover { box-shadow: 0 0 0 2px rgba(0,0,0,0.08) inset; }
  .mark.gruen { background-color: #e6ffe6; border-bottom: 2px solid #228b22; }
  .mark.gelb  { background-color: #fffbe6; border-bottom: 2px dashed #ff8c00; }
  .mark.rot   { background-color: #ffe6e6; border-bottom: 2px dashed #c62828; }

  /* Popover: single reusable panel */
  .popover {
    position: absolute; display: none; width: 320px;
    border: 1px solid #ccc; border-radius: 8px; padding: 0.8rem;
    background: #fff; box-shadow: 0 6px 18px rgba(0,0,0,0.15); z-index: 1000;
  }
  .popover__header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
  .popover__title { font-weight: 700; }
  .popover__close { margin-left: auto; background: transparent; border: none; font-size: 18px; cursor: pointer; }
  .btn { margin-top: 8px; padding: 6px 10px; border: none; border-radius: 4px; background: #003366; color: #fff; cursor: pointer; font-size: 0.9rem; }

  /* Mobile fallback: make popover static under the container for readability */
  @media (max-width: 720px) {
    .container { flex-direction: column; }
    .popover { position: static; width: auto; display: none; margin-top: 12px; }
  }
</style>
</head>
<body>

<!-- Combined top bar: badges + legend -->
<div class="topbar">
  <div class="ampel-badges">
    <button class="badge gruen" data-overlay="gruen">ðŸŸ¢ QualitÃ¤tseinschÃ¤tzung: Sicher</button>
    <button class="badge gelb"  data-overlay="gelb">ðŸŸ¡ QualitÃ¤tseinschÃ¤tzung: Unsicher</button>
    <button class="badge rot"   data-overlay="rot">ðŸ”´ QualitÃ¤tseinschÃ¤tzung: Riskant</button>
  </div>
  <div class="legend" aria-label="Ampel-Legende">
    <div class="legend-item"><span class="dot dot--green"></span> Sicher â€“ direkt verwendbar</div>
    <div class="legend-item"><span class="dot dot--yellow"></span> Unsicher â€“ bitte prÃ¼fen, evtl. verbessern</div>
    <div class="legend-item"><span class="dot dot--red"></span> Riskant â€“ nicht vertrauenswÃ¼rdig</div>
  </div>
</div>

<!-- Overlays triggered by badges -->
<div id="overlay-gruen" class="overlay-box">
  <h3>ðŸŸ¢ Ãœbersetzung â€“ VerlÃ¤sslich</h3>
  <p>Ãœbersetzung ist verlÃ¤sslich. Sie kÃ¶nnen den Text direkt verwenden.</p>
</div>
<div id="overlay-gelb" class="overlay-box">
  <h3>ðŸŸ¡ Ãœbersetzung â€“ VerbesserungsbedÃ¼rftig</h3>
  <p>Ãœbersetzung ist verstÃ¤ndlich, aber nicht perfekt. Mit Vorsicht verwenden â€“ bei wichtigen Inhalten professionelle Hilfe empfohlen.</p>
</div>
<div id="overlay-rot" class="overlay-box">
  <h3>ðŸ”´ Ãœbersetzung â€“ Nicht vertrauenswÃ¼rdig</h3>
  <p><strong>QualitÃ¤tseinschÃ¤tzung:</strong> Niedrig</p>
  <p><strong>Risiko:</strong> Hoch (falsche Bedeutungen, unprofessionelle TonalitÃ¤t)</p>
  <p><strong>Empfehlung:</strong> FÃ¼r wichtige Inhalte bitte nicht verwenden; fÃ¼r grobe Orientierung nur mit Vorsicht.</p>
</div>

<!-- Two windows side-by-side -->
<div class="container" id="container">
  <div class="window">
    <h3>Ausgangstext</h3>
    <div id="source" class="editable" contenteditable="true">
      Segment Alpha ist hier dargestellt.<br>
      Segment Beta folgt im Text.<br>
      Segment Gamma schlieÃŸt den Absatz ab.
    </div>
  </div>

  <div class="window">
    <h3>Zieltext</h3>
    <div id="target" class="editable" contenteditable="true">
      <span class="mark rot"
        data-id="alpha"
        data-level="rot"
        data-back="Segment Alpha (Dummy zurÃ¼ck)"
        data-suggestion="Segment A">Segment Alpha</span><br>
      <span class="mark gelb"
        data-id="beta"
        data-level="gelb"
        data-back="Segment Beta (Dummy zurÃ¼ck)"
        data-suggestion="Segment B">Segment Beta</span><br>
      <span class="mark gruen"
        data-id="gamma"
        data-level="gruen"
        data-back="Segment Gamma (Dummy zurÃ¼ck)"
        data-suggestion="Segment G">Segment Gamma</span>
    </div>
  </div>
</div>

<!-- Single reusable popover -->
<div class="popover" id="popover" role="dialog" aria-label="Segmentdetails">
  <div class="popover__header">
    <span class="dot" id="pop-dot" aria-hidden="true"></span>
    <div class="popover__title" id="pop-title">DQE</div>
    <button class="popover__close" id="pop-close" aria-label="SchlieÃŸen">Ã—</button>
  </div>
  <div id="pop-body">
    <!-- Filled dynamically -->
  </div>
  <button class="btn" id="apply-btn">Vorschlag Ã¼bernehmen</button>
</div>

<script>
(function() {
  const container = document.getElementById('container');
  const pop = document.getElementById('popover');
  const popDot = document.getElementById('pop-dot');
  const popTitle = document.getElementById('pop-title');
  const popBody = document.getElementById('pop-body');
  const applyBtn = document.getElementById('apply-btn');
  const closeBtn = document.getElementById('pop-close');

  // Badge overlays
  document.querySelectorAll('.badge').forEach(b => {
    b.addEventListener('click', () => {
      const key = b.getAttribute('data-overlay');
      document.querySelectorAll('.overlay-box').forEach(o => o.style.display = 'none');
      const target = document.getElementById('overlay-' + key);
      if (target) target.style.display = 'block';
    });
  });

  // Helpers
  function hidePopover() { pop.style.display = 'none'; }
  function setDot(level) {
    popDot.className = 'dot ' + (
      level === 'gruen' ? 'dot--green' : level === 'gelb' ? 'dot--yellow' : 'dot--red'
    );
    popTitle.textContent = 'DQE: ' + (
      level === 'gruen' ? 'Sicher' : level === 'gelb' ? 'Unsicher' : 'Riskant'
    );
  }
  function positionPopover(seg) {
    const isMobile = window.matchMedia('(max-width: 720px)').matches;
    if (isMobile) { return; } // static flow on mobile
    const rect = seg.getBoundingClientRect();
    pop.style.top = (rect.bottom + window.scrollY + 8) + 'px';
    pop.style.left = (rect.left + window.scrollX) + 'px';
  }

  let currentSeg = null;

  // Event delegation for segments
container.addEventListener('click', (e) => {
  const seg = e.target.closest('.mark');
  if (!seg) return;
  currentSeg = seg;

  const level = seg.getAttribute('data-level');
  const back = seg.getAttribute('data-back') || '(keine RÃ¼ckÃ¼bersetzung verfÃ¼gbar)';
  const suggestion = seg.getAttribute('data-suggestion') || seg.textContent.trim();

  // Fill popover content
  setDot(level);
  let html =
    '<p><strong>QualitÃ¤t:</strong> ' + (level==='gruen'?'Hoch':level==='gelb'?'Mittel':'Niedrig') + '<br>' +
    '<strong>Risiko:</strong> ' + (level==='gruen'?'Niedrig':level==='gelb'?'Teilweise vorhanden':'Hoch') + '</p>' +
    '<p><strong>RÃ¼ckÃ¼bersetzung:</strong> â€ž' + seg.textContent.trim() + 'â€œ â†’ â€ž' + back + 'â€œ</p>';

  if (level !== 'gruen') {
    html += '<p><strong>Vorschlag:</strong> <span id="pop-suggestion">' + suggestion + '</span></p>';
    applyBtn.style.display = 'inline-block';
    applyBtn.dataset.suggestion = suggestion;
  } else {
    applyBtn.style.display = 'none'; // kein Vorschlag-Button bei GrÃ¼n
  }

  popBody.innerHTML = html;

  // Show and position
  pop.style.display = 'block';
  positionPopover(seg);
});

  // Apply suggestion: replace text and upgrade to green
  applyBtn.addEventListener('click', () => {
    if (!currentSeg) return;
    const newText = applyBtn.dataset.suggestion || currentSeg.textContent.trim();
    currentSeg.textContent = newText;

    // Upgrade segment to green (Sicher)
    currentSeg.classList.remove('gelb', 'rot');
    currentSeg.classList.add('gruen');
    currentSeg.setAttribute('data-level', 'gruen');
    currentSeg.setAttribute('data-back', newText + ' (Dummy zurÃ¼ck)');
    currentSeg.setAttribute('data-suggestion', newText);

    hidePopover();
  });

  // Close popover
  closeBtn.addEventListener('click', hidePopover);

  // Click outside to close
  document.addEventListener('click', (e) => {
    const inside = e.target.closest('.mark') || e.target.closest('#popover');
    if (!inside) hidePopover();
  });

  // Reposition hides popover
  window.addEventListener('resize', hidePopover);
})();
</script>
</body>
</html>
